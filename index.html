<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">


    <title>Crypto Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/css/main.css">

    <!-- JS -->
    <script src="https://widgets.coingecko.com/gecko-coin-price-chart-widget.js"></script>
    <script src="https://widgets.coingecko.com/gecko-coin-price-marquee-widget.js"></script>
    <script src="https://widgets.coingecko.com/gecko-coin-heatmap-widget.js"></script>

<style>
.twitter-preview {
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 10px;
  background-color: #f5f8fa;
  font-size: 14px;
  margin-top: 5px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.twitter-preview img {
  width: 40px;
  height: 40px;
  border-radius: 5px;
  object-fit: cover;
}
.twitter-preview .meta {
  color: #555;
}
</style>

<script>
document.querySelectorAll('#news-content a').forEach(link => {
  const href = link.href;
  if (href.includes('pic.twitter.com') || href.includes('t.co')) {
    const preview = document.createElement('div');
    preview.className = 'twitter-preview';

    preview.innerHTML = `
      <img src="https://abs.twimg.com/icons/apple-touch-icon-192x192.png" alt="X">
      <div>
        <div><strong>Twitter/X Repost</strong></div>
        <div class="meta">${href}</div>
      </div>
    `;

    link.insertAdjacentElement('afterend', preview);
  }
});
</script>


</head>
<body>
    <!-- Crypto Marque -->
    <div class="row" style="margin:0px; padding: 0px;">
        <div class="col" style="padding: 0px;">
            <gecko-coin-price-marquee-widget 
            locale="en" 
            outlined="true" 
            dark-mode="true" 
            coin-ids="bitcoin,ethereum,tether,binancecoin,pax-gold" 
            initial-currency="usd">
            </gecko-coin-price-marquee-widget>
        </div>
    </div>
    <div class="container" style="padding-top: 20px;">
        <!-- Crypto Block -->
        <div class="row" style="margin-bottom: 20px;">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <!-- TradingView Widget BEGIN -->
                        <div class="tradingview-widget-container">
                        <div class="tradingview-widget-container__widget"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-tickers.js" async>
                        {
                        "symbols": [
                            {
                            "proName": "BITSTAMP:BTCUSD",
                            "title": "Bitcoin"
                            },
                            {
                            "description": "Bitcoin Dominance",
                            "proName": "CRYPTOCAP:BTC.D"
                            },
                            {
                            "description": "USD to IDR",
                            "proName": "FX_IDC:USDIDR"
                            },
                            {
                            "description": "Gold",
                            "proName": "OANDA:XAUUSD"
                            }
                        ],
                        "isTransparent": true,
                        "showSymbolLogo": true,
                        "colorTheme": "dark",
                        "locale": "en"
                        }
                        </script>
                        </div>
                        <!-- TradingView Widget END -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Fear and Greed -->
        <div class="row">
            <div class="col-lg-4" style="margin-bottom: 20px;">
                <div class="card" style="height: 350px;">
                    <div class="card-body" style="padding: 0px;">
                        <div id="fng-widget-container"></div>
                    </div>
                </div>
            </div>
            <!--
            <div class="col-lg-4" style="margin-bottom: 20px;">
                <div class="card" style="height: 350px;">
                    <div class="card-body">
                        <img src="https://alternative.me/crypto/fear-and-greed-index.png" style="object-fit: contain; height:100%; width: 100%; max-height: 300px;" />
                    </div>
                </div>
            </div>
            -->
            <div class="col-lg-8" style="margin-bottom: 20px;">
                <div class="card" style="height: 350px;">
                    <div class="card-body">
                        <div class="card-title">Bitcoin Fear & Greed</div>
                        <div class="row" style="margin-bottom:20px">
                            <div class="col">
                                <button type="button" class="btn btn-secondary btn-custom" onclick="fetchAndPlotFNG(7)">7D</button>
                                <button type="button" class="btn btn-secondary btn-custom" onclick="fetchAndPlotFNG(30)">1M</button>
                                <button type="button" class="btn btn-secondary btn-custom" onclick="fetchAndPlotFNG(90)">3M</button>
                                <button type="button" class="btn btn-secondary btn-custom" onclick="fetchAndPlotFNG(180)">6M</button>
                                <button type="button" class="btn btn-secondary btn-custom" onclick="fetchAndPlotFNG(365)">1Y</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div style="width: 100%;">
                                    <canvas id="fngChart" style="height: 200px;"></canvas>
                                </div>
                                <div class="row" style="text-align: right;">
                                    <div class="col">
                                    <p class="card-credit-text">Powered By Alternative.me</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


        <div class="row" style="text-align: center; margin-bottom: 20px;">
            <div class="col-lg-8">
                <!-- Bitcoin Price -->
                <div class="row" style="margin-bottom: 20px;">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title" style="text-align: left;">Bitcoin Price</div>
                                <div class="row" style="height: 400px;">
                                    <div class="col">
                                <!-- TradingView Widget BEGIN -->
                                <div class="tradingview-widget-container">
                                <div class="tradingview-widget-container__widget"></div>
                                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js" async>
                                {
                                "symbols": [
                                    [
                                    "BITSTAMP:BTCUSD|1M"
                                    ]
                                ],
                                "chartOnly": false,
                                "width": "100%",
                                "height": "100%",
                                "locale": "en",
                                "colorTheme": "dark",
                                "autosize": true,
                                "showVolume": false,
                                "showMA": false,
                                "hideDateRanges": false,
                                "hideMarketStatus": false,
                                "hideSymbolLogo": false,
                                "scalePosition": "right",
                                "scaleMode": "Normal",
                                "fontFamily": "-apple-system, BlinkMacSystemFont, Trebuchet MS, Roboto, Ubuntu, sans-serif",
                                "fontSize": "10",
                                "noTimeScale": false,
                                "valuesTracking": "1",
                                "changeMode": "price-and-percent",
                                "chartType": "area",
                                "maLineColor": "#2962FF",
                                "maLineWidth": 1,
                                "maLength": 9,
                                "headerFontSize": "medium",
                                "lineWidth": 2,
                                "lineType": 0,
                                "dateRanges": [
                                    "1d|1",
                                    "1m|30",
                                    "3m|60",
                                    "12m|1D",
                                    "60m|1W",
                                    "all|1M"
                                ]
                                }
                                </script>
                                </div>
                                </div>
                                <!-- TradingView Widget END -->
                                </div>


                                <!--
                                <gecko-coin-price-chart-widget 
                                locale="en" 
                                dark-mode="true" 
                                transparent-background="true" 
                                coin-id="bitcoin" 
                                initial-currency="usd">
                                </gecko-coin-price-chart-widget>
                                -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Crypto Heatmap -->
                <div class="row" style="margin-bottom: 20px;">
                    <div class="col">
                        <div class="card">
                            <div class="card-body">
                                <div class="card-title" style="text-align: left;">Crypto Heatmap</div>

                                <gecko-coin-heatmap-widget 
                                locale="en" 
                                dark-mode="true" 
                                transparent-background="true" 
                                top="100">
                                </gecko-coin-heatmap-widget>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="col-lg-4">
                <div class= "card">
                    <div class="card-body" style="max-height: 1000px; overflow: scroll;">
                        <div class="card-title" style="text-align: left; margin-bottom:20px">Bitcoin News</div>
                        <div class="row" id="news-spinner" style="display: block;">
                            <div class="col">
                                <div class="spinner-border text-warning" role="status">
                                </div>
                            </div>
                        </div>
                        <div id="news-feed"></div>
                        <button id="load-more" style="background: #f7931a; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 14px; display: none; margin: 20px auto;">Show More</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- News Modal -->
    <div class="modal fade" id="newsModal" tabindex="-1" aria-labelledby="newsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content position-relative">
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>

            <div class="modal-body" id="newsModalBody">
                <div class="row" style="text-align: right;">
                    <div class="col">
                    </div>
                </div>
                <div class="row" style="padding-bottom: 0px;">
                    <div class="col">
                        <p id="news-source" style="font-weight: 400; color:#8c8c8c; font-style: italic;"></p>
                        <a href="#" target="_blank" id="originalLink" class="btn btn-outline-light btn-sm">Open Original</a>
                        <br>
                        <br>
                    </div>
                </div>
                <div class="row" style="padding-bottom: 24px;">
                    <div class="col">
                        <h2 id="news-title" style="font-weight: 600; color:#dbdbdb; font-size: 40px"></h2>
                    </div>
                </div>
                <div class="row" style="padding-bottom: 24px;">
                    <div class="col">
                        <p id="news-time" style="font-weight: 400; color:#8c8c8c; font-style: italic;"></p>
                    </div>
                </div>
                <div class="row">
                    <div class="col" id="news-content" style="color: #dbdbdb; font-weight: 400;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    
    <!-- Bootstrap -->

    <!-- Bootstrap Bundle JS with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>

    <script src="./assets/js/coinstat-fng.js"></script>


    <script>
        async function fetchAndPlotFNG(day_length = 7) {
            try {
                const response = await fetch(`https://api.alternative.me/fng/?limit=${day_length}`);
                const data = await response.json();

                const values = data.data.map(entry => parseInt(entry.value));
                const labels = data.data.map(entry =>
                    new Date(parseInt(entry.timestamp) * 1000).toLocaleDateString("en-US", { month: "short", day: "numeric" })
                );

                plotChart(labels.reverse(), values.reverse());
            } catch (error) {
                console.error("Error fetching Fear & Greed Index:", error);
            }
        }

        let chartInstance = null;

        function plotChart(labels, values) {
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const ctx = document.getElementById("fngChart").getContext("2d");

            chartInstance = new Chart(ctx, {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [{
                    label: "Fear & Greed Index",
                    data: values,
                    borderColor: "#BCFF2F",
                    backgroundColor: "rgba(188, 255, 47, 0.1)",
                    pointRadius: 0,         // ðŸ”¹ hides data point circles
                    pointHoverRadius: 0,     // ðŸ”¹ hides hover effect on points
                    fill: true,
                    tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            ticks: {
                            maxTicksLimit: 7,
                            autoSkip: true,
                            color: '#fff'
                            },
                            title: {
                                display: false,
                                text: 'Date',
                                color: '#fff'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Fear & Greed Index',
                                color: '#fff'
                            },
                            ticks: {
                                color: '#fff'
                            }
                        },
                    },
                    maintainAspectRatio : false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                        annotation: {
                            annotations: {
                            line80: {
                                type: 'line',
                                yMin: 80,
                                yMax: 80,
                                borderColor: 'rgba(255,255,255,0.5)',
                                borderWidth: 1,
                                label: {
                                content: 'Extreme Greed',
                                enabled: true,
                                position: 'start',
                                yAdjust: -10,
                                backgroundColor: 'rgba(0,0,0,0.5)',
                                color: 'rgba(255,255,255,0.7)'
                                }
                            },
                            line20: {
                                type: 'line',
                                yMin: 20,
                                yMax: 20,
                                borderColor: 'rgba(255,255,255,0.5)',
                                borderWidth: 1,
                                label: {
                                content: 'Extreme Fear',
                                enabled: true,
                                position: 'start',
                                yAdjust: -10,
                                backgroundColor: 'rgba(0,0,0,0.5)',
                                color: 'rgba(255,255,255,0.7)'
                                }
                            }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index',
                    },
                                        
                }
            });
        }



        // Call the async function
        fetchAndPlotFNG(7);
    </script>

    <script>
        function showModal(index) {
            const item = window.newsData[index];
            console.log(item)
            if (!item) return;

            const fullContent = item['content:encoded'] || item.content || item.description || 'No content available.';
  
            document.getElementById('news-source').textContent = "Source : " + item.source;
            document.getElementById('news-title').textContent = item.title;
            document.getElementById('news-time').textContent = item.pubDate;

            document.getElementById('news-content').innerHTML = item.content;
            document.getElementById('originalLink').href = item.link;

            const modal = new bootstrap.Modal(document.getElementById('newsModal'));
            modal.show();
        }



    </script>

    <script src="./assets/js/newsfeed.js"></script>

</body>
</html>